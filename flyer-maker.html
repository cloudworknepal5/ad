<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom News Card Generator</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --primary-red: #ed1c24; --dark-blue: #002e5b; }
        body { font-family: 'Mukta', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        /* १. कन्ट्रोल प्यानल (Input Form) */
        .control-panel { 
            background: #fff; padding: 20px; border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 800px; 
            margin-bottom: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        .control-panel h2 { grid-column: 1 / -1; margin-top: 0; color: var(--dark-blue); border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .input-group { display: flex; flex-direction: column; }
        .input-group label { font-size: 14px; font-weight: bold; margin-bottom: 5px; color: #555; }
        .input-group input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; }
        .full-width { grid-column: 1 / -1; }
        .btn-update { background: var(--dark-blue); color: #fff; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        
        /* २. कार्ड डिस्प्ले एरिया (Scaling Container) */
        #gh-master-container { transform-origin: top center; transition: 0.3s; margin-bottom: 20px; }
        
        .gh-master-wrap { 
            width: 1200px; height: 630px; border: 15px solid var(--primary-red); 
            background: #fff; box-sizing: border-box; position: relative;
            display: flex; flex-direction: column; overflow: hidden;
        }

        .gh-logo-watermark { position: absolute; top: 30px; right: 25px; width: 160px; height: 60px; object-fit: contain; z-index: 100; }
        .gh-img-frame { position: relative; width: 100%; height: 430px; background: #000; overflow: hidden; }
        .gh-img-frame img { width: 100%; height: 100%; object-fit: cover; }
        .gh-red-overlay { position: absolute; top: 12px; left: 12px; right: 12px; bottom: 12px; border: 2px solid rgba(237, 28, 36, 0.4); z-index: 10; }
        .gh-small-ribbon { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--primary-red); color: #fff; padding: 3px 35px; font-size: 16px; font-weight: 700; border-radius: 3px; }
        
        .gh-social-icons { position: absolute; bottom: 10px; left: 20px; display: flex; gap: 10px; z-index: 110; }
        .icon-box { width: 40px; height: 40px; background: #fff; border-radius: 50%; border: 1.5px solid var(--primary-red); display: flex; align-items: center; justify-content: center; color: var(--primary-red); font-size: 20px; cursor: pointer; }

        .gh-headline { flex-grow: 1; display: flex; align-items: center; justify-content: center; padding: 10px 40px; font-size: 52px; font-weight: 800; color: var(--primary-red); line-height: 1.1; text-align: center; }
        .gh-footer-strip { background: var(--dark-blue); color: #fff; padding: 5px 60px; font-weight: 800; font-size: 22px; border-radius: 5px 5px 0 0; width: fit-content; margin: 0 auto; }

        .nav-controls { display: flex; gap: 15px; margin-top: 20px; }
        .nav-btn { padding: 10px 25px; border-radius: 5px; border: none; cursor: pointer; font-weight: bold; background: var(--primary-red); color: white; }
        .nav-btn:disabled { background: #ccc; }

        @media (max-width: 1200px) {
            #gh-master-container { transform: scale(0.6); margin-bottom: -200px; }
        }
        @media (max-width: 600px) {
            .control-panel { grid-template-columns: 1fr; }
            #gh-master-container { transform: scale(0.3); margin-bottom: -400px; }
        }
    </style>
</head>
<body>

<div class="control-panel">
    <h2>टुल सेटिङ (Settings)</h2>
    <div class="input-group full-width">
        <label>वर्डप्रेस वेबसाइट डोमेन (उदा: nepaltopkhabar.com)</label>
        <input type="text" id="in-domain" value="nepaltopkhabar.com">
    </div>
    <div class="input-group">
        <label>वेबसाइटको नाम</label>
        <input type="text" id="in-site-name" value="NepalTopKhabar">
    </div>
    <div class="input-group">
        <label>लोगो युआरएल (Direct Image Link)</label>
        <input type="text" id="in-logo" value="https://nepaltopkhabar.com/wp-content/uploads/2025/09/logo11-copy-300x84.png">
    </div>
    <div class="input-group">
        <label>युट्युब च्यानल लिंक</label>
        <input type="text" id="in-youtube" value="https://youtube.com">
    </div>
    <div class="input-group">
        <label>ह्वाट्सएप नम्बर (सन्देशका लागि)</label>
        <input type="text" id="in-whatsapp" value="98XXXXXXXX">
    </div>
    <button class="btn-update full-width" onclick="loadUserConfig()">डाटा अपडेट गर्नुहोस्</button>
</div>

<div id="gh-master-container"></div>

<div class="nav-controls">
    <button class="nav-btn" onclick="move(-1)" id="prevBtn">← अघिल्लो</button>
    <button class="nav-btn" onclick="capturePNG()">डाउनलोड PNG</button>
    <button class="nav-btn" onclick="move(1)" id="nextBtn">अर्को →</button>
</div>

<script>
let posts = [];
let currentIdx = 0;
let config = {
    domain: "nepaltopkhabar.com",
    siteName: "NepalTopKhabar",
    logo: "https://nepaltopkhabar.com/wp-content/uploads/2025/09/logo11-copy-300x84.png",
    youtube: "https://youtube.com",
    whatsapp: ""
};

/** Multi-function 1: Configuration Loader **/
function loadUserConfig() {
    config.domain = document.getElementById('in-domain').value;
    config.siteName = document.getElementById('in-site-name').value;
    config.logo = document.getElementById('in-logo').value;
    config.youtube = document.getElementById('in-youtube').value;
    config.whatsapp = document.getElementById('in-whatsapp').value;
    
    fetchPosts(); // नयाँ डोमेनबाट डाटा तान्ने
}

/** Multi-function 2: WordPress API Fetcher **/
async function fetchPosts() {
    try {
        const res = await fetch(`https://${config.domain}/wp-json/wp/v2/posts?_embed&per_page=10`);
        posts = await res.json();
        currentIdx = 0;
        updateUI();
    } catch (e) {
        alert("पोस्टहरू फेला परेनन्। कृपया डोमेन सही छ कि छैन चेक गर्नुहोस्।");
    }
}

/** Multi-function 3: Image Proxy (CORS Fix) **/
function getImg(url) {
    return url ? `https://images.weserv.nl/?url=${encodeURIComponent(url.replace(/https?:\/\//, ""))}` : "https://via.placeholder.com/1200x430";
}

/** Multi-function 4: UI Renderer **/
function updateUI() {
    const box = document.getElementById('gh-master-container');
    const p = posts[currentIdx];
    if(!p) return;

    const featuredImg = p._embedded['wp:featuredmedia'] ? p._embedded['wp:featuredmedia'][0].source_url : "";
    
    box.innerHTML = `
        <div class="gh-master-wrap">
            <img src="${getImg(config.logo)}" class="gh-logo-watermark">
            <div class="gh-img-frame">
                <img src="${getImg(featuredImg)}">
                <div class="gh-red-overlay">
                    <div class="gh-small-ribbon">${config.domain}</div>
                </div>
                <div class="gh-social-icons">
                    <div class="icon-box"><i class="fab fa-facebook-f"></i></div>
                    <div class="icon-box" onclick="window.open('${config.youtube}')"><i class="fab fa-youtube"></i></div>
                    <div class="icon-box" onclick="shareWA('${p.title.rendered}')"><i class="fab fa-whatsapp"></i></div>
                </div>
            </div>
            <div class="gh-headline">${p.title.rendered}</div>
            <div class="gh-footer-strip">समाचारको लिंक कमेन्टमा राखिएको छ।</div>
        </div>
    `;
    
    document.getElementById('prevBtn').disabled = currentIdx === 0;
    document.getElementById('nextBtn').disabled = currentIdx === posts.length - 1;
}

/** Multi-function 5: Social Sharing **/
function shareWA(title) {
    const url = `https://wa.me/${config.whatsapp}?text=${encodeURIComponent("*"+title+"*\nविवरणका लागि: "+config.domain)}`;
    window.open(url, '_blank');
}

/** Multi-function 6: PNG Downloader **/
async function capturePNG() {
    const target = document.querySelector('.gh-master-wrap');
    html2canvas(target, { useCORS: true, scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = `news-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });
}

function move(n) { currentIdx += n; updateUI(); }

// Initial Load
fetchPosts();
</script>

</body>
</html>
