<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neelamb-FB Card Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    
    <style>
        :root { --fb-red: #ed1c24; --fb-blue: #002e5b; }
        body { background: #f4f4f4; margin: 0; padding: 0; font-family: 'Mukta', sans-serif; }
        
        #gh-outer-wrapper {
            width: 100%; overflow: hidden; display: flex; 
            flex-direction: column; align-items: center; padding-bottom: 50px;
        }

        .gh-instructions {
            background: #fff3f3; border-left: 5px solid var(--fb-red);
            padding: 15px; margin: 20px auto; width: 90%; max-width: 800px;
            border-radius: 8px; font-size: 16px; color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .gh-controls-panel {
            background: #fff; padding: 20px; border-bottom: 1px solid #ddd; 
            width: 100%; display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 10px;
        }
        .gh-controls-panel select, .gh-controls-panel input { padding: 8px; border-radius: 4px; border: 1px solid #ccc; font-family: 'Mukta'; }
        
        .gh-dynamic-inputs {
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; width: 100%; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc;
        }
        .gh-dynamic-inputs input { min-width: 250px; font-size: 14px; }

        #gh-master-container { 
            transform-origin: top center; 
            transition: transform 0.2s ease-out; 
            margin: 20px 0; padding: 10px;
        }

        /* CARD STYLING */
        .gh-master-wrap { 
            width: 1200px; height: 630px; 
            background: #222; border: 15px solid var(--fb-red); 
            box-sizing: border-box; position: relative;
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); outline: none;
        }

        /* DRAGGABLE LOGO */
        .gh-logo-watermark { 
            position: absolute; 
            bottom: 30px; 
            right: 25px; 
            width: 160px; height: auto; 
            z-index: 150; 
            object-fit: contain; 
            cursor: move;
            touch-action: none;
            will-change: transform;
        }

        /* PHOTO FULL SIZE */
        .gh-img-frame { 
            position: absolute; inset: 0; width: 100%; height: 100%;
            background: #222; overflow: hidden; display: flex; 
            align-items: center; justify-content: center; touch-action: none;
            z-index: 1;
        }
        
        .draggable-img { position: absolute; will-change: transform; cursor: move; max-width: none; }

        .gh-red-overlay { 
            position: absolute; inset: 12px;
            border: 2px solid rgba(237, 28, 36, 0.4); z-index: 10; pointer-events: none; 
        }

        .gh-small-ribbon { 
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%); 
            background: var(--fb-red); color: #fff; padding: 3px 35px; 
            font-size: 20px; font-weight: 700; z-index: 60; border-radius: 3px; 
        }

        /* DRAGGABLE SOCIAL ICONS */
        .gh-social-icons { 
            position: absolute; bottom: 30px; left: 25px; 
            display: flex; flex-direction: column; gap: 10px; 
            z-index: 140; 
            cursor: move;
            touch-action: none;
            will-change: transform;
        }
        .gh-social-icons img { 
            width: 38px; height: 38px; background: #fff; padding: 7px; 
            border-radius: 50%; border: 1px solid var(--fb-red); box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            pointer-events: none;
        }

        /* DRAGGABLE TITLE WITH DYNAMIC STROKE */
        .gh-headline { 
            position: absolute; 
            top: 40px; 
            left: 0; right: 0;
            padding: 20px 40px; 
            font-weight: 800; 
            color: #fff; 
            font-size: 75px; 
            line-height: 1.1; 
            text-align: center; 
            z-index: 130; 
            word-break: keep-all;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.2); 
            cursor: move;
            touch-action: none;
            will-change: transform;
            /* Multi-Function: Initial Stroke */
            -webkit-text-stroke: 1px #ffffff;
            paint-order: stroke fill;
        }

        .gh-nav-row { display: flex; justify-content: center; gap: 15px; margin: 20px 0; width: 100%; }
        .gh-nav-btn { background: var(--fb-red); color: #fff; padding: 12px 30px; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; font-size: 18px; }
        .gh-nav-btn:disabled { background: #ccc; }
        
        .zoom-ctrl { display: flex; align-items: center; gap: 10px; background: #eee; padding: 5px 15px; border-radius: 20px; font-size: 14px; }
        .zoom-label { font-weight: bold; color: #555; }
    </style>
</head>
<body>

<div id="gh-outer-wrapper">
    <div class="gh-instructions">
        <b><i class="fas fa-arrows-alt"></i> पूर्ण नियन्त्रण:</b>
        <ul>
            <li><b>सार्न मिल्ने:</b> फोटो, शीर्षक, लोगो र सोसल आइकनहरू सबैलाई ड्रयाग गर्न सकिन्छ।</li>
            <li><b>टेक्स्ट स्ट्रोक:</b> अब शीर्षकमा बोर्डर (Stroke) थप्न र मोटाइ मिलाउन सकिन्छ।</li>
        </ul>
    </div>

    <div class="gh-controls-panel">
        <select id="formatSelector" onchange="changeFormat()">
            <option value="landscape" data-w="1200" data-h="630">Facebook Landscape (1200x630)</option>
            <option value="square" data-w="1200" data-h="1200">Facebook Square (1200x1200)</option>
            <option value="portrait" data-w="1080" data-h="1350">Facebook Portrait (1080x1350)</option>
            <option value="stories" data-w="1080" data-h="1920">Stories / Reels (1080x1920)</option>
        </select>

        <div class="zoom-ctrl">
            <span class="zoom-label">Image Zoom:</span>
            <input type="range" id="imgZoom" min="1" max="5" step="0.1" value="1" oninput="applyTransform()">
        </div>

        <div class="zoom-ctrl">
            <span class="zoom-label">Title Size:</span>
            <input type="range" id="titleSize" min="30" max="120" step="1" value="75" oninput="applyTitleStyles()">
        </div>

        <div class="zoom-ctrl">
            <span class="zoom-label">Text Color:</span>
            <input type="color" id="titleColor" value="#ffffff" oninput="applyTitleStyles()">
        </div>

        <div class="zoom-ctrl">
            <span class="zoom-label">Stroke:</span>
            <input type="color" id="strokeColor" value="#ffffff" oninput="applyTitleStyles()">
            <input type="range" id="strokeWidth" min="0" max="5" step="0.5" value="1" oninput="applyTitleStyles()" style="width: 60px;">
        </div>

        <button onclick="capturePNG()" style="background: #28a745; color: white; padding: 8px 20px; border: none; border-radius: 4px; cursor: pointer;">
            <i class="fas fa-download"></i> HD डाउनलोड
        </button>

        <div class="gh-dynamic-inputs">
            <input type="text" id="inputDomain" placeholder="Blogger URL" value="https://www.birgunj.eu.org">
            <input type="text" id="inputCustomName" placeholder="आफ्नो नाम यहाँ लेख्नुहोस्" value="Neelamb.com">
            <input type="text" id="inputLogo" placeholder="Logo Direct URL" value="https://blogger.googleusercontent.com/img/a/AVvXsEgYs0647clgoWQC3ORQwtqpad0VDIrBI79h63NovgIKr29srh_C19HJk7OCbTquzxfofL7huTIp7wDCgE9W9fo_cmqE31j8GIm9B6ePJZU1pAEa5pnfTl7aB27FJjw7Vo8gk0327lNtNrurlgqSpRwSRRQIpC4gVvN9KdgtsDoXDYM8ZdfNB-IYHSmiaw=s200">
            <button onclick="updateSettings()" style="background: #002e5b; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer;">
                <i class="fas fa-sync-alt"></i> Update
            </button>
        </div>
    </div>

    <div id="gh-master-container"></div>
</div>

<script>
let gh_posts_data = [];
let gh_current_idx = 0;

let imgState = { x: 0, y: 0, scale: 1 };
let titleState = { x: 0, y: 0 };
let logoState = { x: 0, y: 0 };
let socialState = { x: 0, y: 0 };

let SITE_DOMAIN = "neelamb.com";
let CUSTOM_NAME = "Neelamb.com";
let SITE_LOGO_URL = "";

/** Multi-Function: HD Image Optimizer for Blogger **/
function getBloggerHD(url) {
    if (!url) return '';
    return url.replace(/\/s[0-9]+(-[a-z0-9-]+)?\//, '/s1600/')
              .replace(/\/w[0-9]+-h[0-9]+(-[a-z0-9-]+)?\//, '/s1600/')
              .split('=s')[0] + '=s1600';
}

/** Multi-Function: Blogger JSONP Loader **/
function updateSettings() {
    const d = document.getElementById('inputDomain').value.trim().replace(/^https?:\/\//, '').replace(/\/$/, '');
    const l = document.getElementById('inputLogo').value.trim();
    const n = document.getElementById('inputCustomName').value.trim();
    
    if(d) SITE_DOMAIN = d;
    if(l) SITE_LOGO_URL = l;
    if(n) CUSTOM_NAME = n;

    const callbackName = `ghCB_${Math.random().toString(36).substr(2, 5)}`;
    window[callbackName] = (data) => {
        gh_posts_data = data.feed.entry || [];
        if (gh_posts_data.length > 0) {
            gh_current_idx = 0;
            updateDisplay();
        } else {
            alert("समाचार भेटिएन!");
        }
    };

    const script = document.createElement('script');
    script.src = `https://${SITE_DOMAIN}/feeds/posts/default?alt=json-in-script&callback=${callbackName}&max-results=50`;
    document.head.appendChild(script);
}

function applyTransform() {
    const img = document.querySelector('.draggable-img');
    if(!img) return;
    imgState.scale = document.getElementById('imgZoom').value;
    img.style.transform = `translate(${imgState.x}px, ${imgState.y}px) scale(${imgState.scale})`;
}

/** Multi-Function: Dynamic Title Styles (Color, Size, Stroke) **/
function applyTitleStyles() {
    const headline = document.querySelector('.gh-headline');
    if(!headline) return;
    
    const size = document.getElementById('titleSize').value;
    const color = document.getElementById('titleColor').value;
    const sColor = document.getElementById('strokeColor').value;
    const sWidth = document.getElementById('strokeWidth').value;
    
    headline.style.fontSize = size + 'px';
    headline.style.color = color;
    headline.style.webkitTextStroke = `${sWidth}px ${sColor}`;
}

/** Multi-Function: Initialize Draggable elements **/
function initDraggable() {
    interact('.draggable-img').draggable({
        listeners: { move(event) { imgState.x += event.dx; imgState.y += event.dy; applyTransform(); } }
    });

    interact('.gh-headline').draggable({
        listeners: { move(event) { 
            titleState.x += event.dx; titleState.y += event.dy;
            event.target.style.transform = `translate(${titleState.x}px, ${titleState.y}px)`;
        } }
    });

    interact('.gh-logo-watermark').draggable({
        listeners: { move(event) { 
            logoState.x += event.dx; logoState.y += event.dy;
            event.target.style.transform = `translate(${logoState.x}px, ${logoState.y}px)`;
        } }
    });

    interact('.gh-social-icons').draggable({
        listeners: { move(event) { 
            socialState.x += event.dx; socialState.y += event.dy;
            event.target.style.transform = `translate(${socialState.x}px, ${socialState.y}px)`;
        } }
    });
}

function changeFormat() {
    const sel = document.getElementById('formatSelector');
    const opt = sel.options[sel.selectedIndex];
    const wrap = document.querySelector('.gh-master-wrap');
    if(wrap) {
        wrap.style.width = opt.getAttribute('data-w') + 'px';
        wrap.style.height = opt.getAttribute('data-h') + 'px';
    }
    adjustScale();
}

function adjustScale() {
    const container = document.getElementById('gh-master-container');
    const wrap = document.querySelector('.gh-master-wrap');
    if(!wrap) return;
    const scale = Math.min((window.innerWidth - 40) / parseInt(wrap.style.width), 1);
    container.style.transform = `scale(${scale})`;
    container.style.marginBottom = `-${parseInt(wrap.style.height) * (1 - scale)}px`;
}

/** Final UI Display **/
function updateDisplay() {
    const box = document.getElementById('gh-master-container');
    const p = gh_posts_data[gh_current_idx];
    if(!p) return;

    const title = p.title.$t;
    const thumb = p.media$thumbnail ? getBloggerHD(p.media$thumbnail.url) : '';
    
    imgState = { x: 0, y: 0, scale: 1 };
    titleState = { x: 0, y: 0 };
    logoState = { x: 0, y: 0 };
    socialState = { x: 0, y: 0 };

    box.innerHTML = `
        <div class="gh-master-wrap">
            <img src="https://images.weserv.nl/?url=${encodeURIComponent(SITE_LOGO_URL.replace('https://',''))}" class="gh-logo-watermark">
            
            <div class="gh-img-frame">
                <img src="https://images.weserv.nl/?url=${encodeURIComponent(thumb.replace('https://',''))}" class="draggable-img" id="mainImg">
                <div class="gh-red-overlay">
                    <div class="gh-small-ribbon">${CUSTOM_NAME}</div>
                </div>
                <div class="gh-social-icons">
                    <img src="https://cdn-icons-png.flaticon.com/512/733/733547.png">
                    <img src="https://cdn-icons-png.flaticon.com/512/3046/3046121.png">
                    <img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png">
                    <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png">
                </div>
            </div>

            <div class="gh-headline">${title}</div>
        </div>
        <div class="gh-nav-row">
            <button class="gh-nav-btn" onclick="move(-1)" ${gh_current_idx === 0 ? 'disabled' : ''}>← अघिल्लो</button>
            <button class="gh-nav-btn" onclick="move(1)" ${gh_current_idx === gh_posts_data.length - 1 ? 'disabled' : ''}>अर्को →</button>
        </div>
    `;
    const imgEl = document.getElementById('mainImg');
    imgEl.onload = () => { 
        initDraggable(); 
        changeFormat(); 
        applyTitleStyles(); // Apply current styles to new post
    };
}

async function capturePNG() {
    const container = document.getElementById('gh-master-container');
    const target = document.querySelector('.gh-master-wrap');
    const originalTransform = container.style.transform;
    window.scrollTo(0,0);
    container.style.transform = "scale(1)";
    
    setTimeout(async () => {
        const canvas = await html2canvas(target, { useCORS: true, scale: 2 });
        const link = document.createElement('a');
        link.download = `news-overlay-${Date.now()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
        container.style.transform = originalTransform;
    }, 500);
}

window.move = (n) => { gh_current_idx += n; updateDisplay(); };
window.addEventListener('resize', adjustScale);

// Start
updateSettings();
</script>

</body>
</html>